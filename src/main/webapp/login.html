<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>login</title>
    <meta name="description" content="particles.js is a lightweight JavaScript library for creating particles.">
    <meta name="author" content="Vincent Garreau"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" media="screen" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/reset.css"/>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.bootcss.com/vue-resource/1.5.1/vue-resource.js"></script>
    <!--<script src="statics/myCss.css"></script>-->
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
</head>
<body>

<div id="particles-js">
    <div class="login">

        <div id="app">
            <router-view></router-view>
        </div>
        <template id="login">
            <div>
                <div class="login-top">
                    登录
                </div>
                <div v-if="error" class="alert alert-danger alert-dismissible" style="height: 30px;padding: 5px">
                    <i class="fa fa-exclamation-triangle">{{errorMsg}}</i>
                </div>
                <div class="login-center clearfix">
                    <div class="login-center-img"><img src="img/name.png"/></div>
                    <div class="login-center-input">
                        <input type="text" name="" value="" v-model="username" placeholder="请输入您的用户名"
                               onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的用户名'"/>
                        <div class="login-center-input-text">用户名</div>
                    </div>
                </div>
                <div class="login-center clearfix">
                    <div class="login-center-img"><img src="img/password.png"/></div>
                    <div class="login-center-input">
                        <input type="password" name="" value="" v-model="password" placeholder="请输入您的密码"
                               onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的密码'"/>
                        <div class="login-center-input-text">密码</div>
                    </div>

                </div>
                <div class="login-center clearfix">
                    <div class="login-center-img"><img style="opacity: 0.6;" src="img/594c97a20dbd9_610.jpg"/></div>
                    <div class="login-center-input">
                        <input type="text" name="" value="" v-model="captcha" @keyup.enter="login" placeholder="请输入验证码"
                               onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的验证码'"/>
                        <div class="login-center-input-text">验证码</div>
                    </div>
                </div>
                <div class="form-group has-feedback" style="margin-left: 48px;margin-bottom: 10px">
                    <img alt="如果看不清楚，请单击图片刷新！" class="pointer" :src="src" @click="refreshCode">
                    <a href="javascript:;" @click="refreshCode">点击刷新</a>
                </div>
                <div class="login-button" style="margin-bottom: 20px;margin-top: 35px" @click="login">
                    登录
                </div>
                <div style="margin-top: 20px;text-align:center">
                    <a href="#/register" class="r_float">注册</a>
                </div>
            </div>
        </template>
        <template id="register">
            <div>
                <div class="login-top"  >
                    注册
                </div>
                <div v-if="error" class="alert alert-danger alert-dismissible" style="height: 30px;padding: 5px">
                    <i class="fa fa-exclamation-triangle">{{errorMsg}}</i>
                </div>
                <div class="login-center clearfix">
                    <div class="login-center-img"><img src="img/name.png"/></div>
                    <div class="login-center-input">
                        <input type="text" name="" value="" v-model="username" placeholder="请输入您的用户名" onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的用户名'"/>
                        <div class="login-center-input-text">用户名</div>
                    </div>
                </div>
                <div class="login-center clearfix">
                    <div class="login-center-img"><img src="img/password.png"/></div>
                    <div class="login-center-input">
                        <input type="password" name=""value="" v-model="password" placeholder="请输入您的密码" onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的密码'"/>
                        <div class="login-center-input-text">密码</div>
                    </div>

                </div>
                <div class="login-center clearfix">
                    <div class="login-center-img"><img style="opacity: 0.6;" src="img/20191015155558.jpg"/></div>
                    <div class="login-center-input">
                        <input type="text" name=""value="" v-model="phone" placeholder="请输入您的手机号" onfocus="this.placeholder=''" onblur="this.placeholder='请输入您的手机号'"/>
                        <div class="login-center-input-text">手机号</div>
                    </div>

                </div>
                <div class="form-group has-feedback" style="margin-left: 40px" >
                    <div class="login-center-img" ><img style="opacity: 0.6;" src="img/594c97a20dbd9_610.jpg"/></div>
                    <div class="login-center-input" style="width: 200px">
                        <input style="width: 190px" type="text" name=""value="" v-model="verificationCode" @keyup.enter="login" placeholder="请输入验证码" onfocus="this.placeholder=''" onblur="this.placeholder='请输入验证码'"/>
                        <div class="login-center-input-text">验证码</div>
                    </div>
                    <!--<a href="javascript:;" @click="register">获取验证码</a>-->
                    <button style="width: 65px" id="send-btn" class="btn" @click="register" ref="sendRegister" :disabled="btnDisable">{{btnCn}}</button>
                </div>
                <div class="login-button" style="margin-bottom: 20px"  @click="verification">
                    注册
                </div>
                <div style="margin-top: 20px;text-align:center" >
                    <a href="#/login" class="r_float">登录</a>
                </div>
            </div>
        </template>
        <div class="sk-rotating-plane"></div>

    </div>
</div>
<!-- scripts -->
<script src="js/particles.min.js"></script>
<script src="js/app.js"></script>
<script type="text/javascript">

    var login = {
        template: '#login',
        props: ['data'],
        data() {
            return {
                msg: 'test',
                username: '',
                password: '',
                captcha: '',
                error: false,
                errorMsg: '',
                src: 'user/captcha.jpg'
            }
        },
        methods: {
            refreshCode() {
                this.src = "user/captcha.jpg?" + $.now();
            },
            login() {
                this.$http.post('home/login', {
                    account: this.username,
                    passWord: this.password,
                    verificationCode: this.captcha
                }, {}).then(function (result) {

                    if (result.body.code == 0000) {
                        addClass(document.querySelector(".login"), "active")
                        setTimeout(function () {
                            addClass(document.querySelector(".sk-rotating-plane"), "active")
                            document.querySelector(".login").style.display = "none"
                        }, 800)
                        parent.location.href = 'index.html';
                    } else {
                        this.error = true;
                        this.errorMsg = result.body.msg;
                        this.refreshCode();
                    }
                })
            }
        }

    }
    var register = {
        template: '#register',
        data() {
            return {
                username: null,
                password: null,
                phone:null,
                verificationCode:null,
                error: false,
                errorMsg: null,
                btnCn:'发送',
                btnDisable:false
            }
        },
        methods:{
        register(){
            var that = this;
            var num = 60;
            this.$http.post('home/register',{
                account:this.username,
                passWord:this.password,
                phone:this.phone,
                verificationCode:this.verificationCode,
            },{}).then(function (result) {
                if (result.body.code==0000){
                    //禁用按钮
                    that.btnDisable = true;
                    //定时器
                    var time = setInterval(function(){
                        num--
                        if(num <= 0){
                            //清空定时器
                            clearInterval(time);
                            that.btnCn = '发送'
                            that.btnDisable = false;
                            return;
                        }
                        that.btnCn = num+'s'
                    },1000)
                }else {
                    this.error=true;
                    this.errorMsg=result.body.msg;
                }
            })
        },
            verification(){
            this.$http.post('home/verification',{
                account: this.username,
                passWord: this.password,
                verificationCode: this.verificationCode
            },{}).then(function (result) {
                if (result.body.code==0000){
                    alert('注册成功');
                    parent.location.href = '#/login';
                }else {
                    this.error = true;
                    this.errorMsg = result.body.msg;
                    this.refreshCode();
                }
            })
            },

        }
    }
    var router = new VueRouter({
        routes: [
            {path: '/', component: login},
            {path: '/login', component: login},
            {path: '/register', component: register}
        ]
    })

    var vm = new Vue({
        el: '#app',
        data: {
            msg: 'test',
            username: '',
            password: '',
            captcha: '',
            error: false,
            errorMsg: '',
            src: 'user/captcha.jpg'
        },
        methods: {
            refreshCode() {
                this.src = "user/captcha.jpg?" + $.now();
            },
            login() {
                this.$http.post('home/login', {
                    account: this.username,
                    passWord: this.password,
                    verificationCode: this.captcha
                }, {}).then(function (result) {

                    if (result.body.code == 0000) {
                        addClass(document.querySelector(".login"), "active")
                        setTimeout(function () {
                            addClass(document.querySelector(".sk-rotating-plane"), "active")
                            document.querySelector(".login").style.display = "none"
                        }, 800)
                        parent.location.href = 'index.html';
                    } else {
                        this.error = true;
                        this.errorMsg = result.body.msg;
                        this.refreshCode();
                    }
                })
            }
        },
        router: router
    })

    function hasClass(elem, cls) {
        cls = cls || '';
        if (cls.replace(/\s/g, '').length == 0) return false; //当cls没有参数时，返回false
        return new RegExp(' ' + cls + ' ').test(' ' + elem.className + ' ');
    }

    function addClass(ele, cls) {
        if (!hasClass(ele, cls)) {
            ele.className = ele.className == '' ? cls : ele.className + ' ' + cls;
        }
    }

    function removeClass(ele, cls) {
        if (hasClass(ele, cls)) {
            var newClass = ' ' + ele.className.replace(/[\t\r\n]/g, '') + ' ';
            while (newClass.indexOf(' ' + cls + ' ') >= 0) {
                newClass = newClass.replace(' ' + cls + ' ', ' ');
            }
            ele.className = newClass.replace(/^\s+|\s+$/g, '');
        }
    }

</script>

<div style="text-align:center;">

</div>
</body>
</html>